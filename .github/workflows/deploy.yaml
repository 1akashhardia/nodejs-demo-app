name: Deploy

on: 
  workflow_call:        
  
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_ARN }}  
          aws-region: ${{ secrets.AWS_REGION }}
          audience: sts.amazonaws.com
          output-env-credentials: true
      - run: aws eks update-kubeconfig --name ${{ secrets.EKS_CLUSTER }} --region ${{ secrets.AWS_REGION }}
      - uses: azure/setup-helm@v4
      - run: helm upgrade --install demo-app ./charts/demo-app --set tag=${{ github.sha }} --set ecrRepo=${{ secrets.ECR_REPO }}